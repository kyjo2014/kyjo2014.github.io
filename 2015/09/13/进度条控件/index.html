<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>进度条控件 | LTH&#39;s note book</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="kyjo2014">
  
  
    <meta name="description" content="var  COREHTML5 = COREHTML5 || {};
COREHTML5.RoundedRectangle = function (strokeStyle,fillStyle,horizontalSizePercent,verticalSizePercent){
    this.strokeStyle = strokeStyle ?strokeStyle :&amp;apos;gray&amp;a">
  
  <meta name="description" content="var  COREHTML5 = COREHTML5 || {};
COREHTML5.RoundedRectangle = function (strokeStyle,fillStyle,horizontalSizePercent,verticalSizePercent){
    this.strokeStyle = strokeStyle ?strokeStyle :&amp;apos;gray&amp;a">
<meta property="og:type" content="article">
<meta property="og:title" content="进度条控件">
<meta property="og:url" content="http://yoursite.com/2015/09/13/进度条控件/index.html">
<meta property="og:site_name" content="LTH's note book">
<meta property="og:description" content="var  COREHTML5 = COREHTML5 || {};
COREHTML5.RoundedRectangle = function (strokeStyle,fillStyle,horizontalSizePercent,verticalSizePercent){
    this.strokeStyle = strokeStyle ?strokeStyle :&amp;apos;gray&amp;a">
<meta property="og:updated_time" content="2015-09-13T15:45:59.594Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="进度条控件">
<meta name="twitter:description" content="var  COREHTML5 = COREHTML5 || {};
COREHTML5.RoundedRectangle = function (strokeStyle,fillStyle,horizontalSizePercent,verticalSizePercent){
    this.strokeStyle = strokeStyle ?strokeStyle :&amp;apos;gray&amp;a">
  
    <link rel="alternate" href="/atom.xml" title="LTH&#39;s note book" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">LTH&#39;s note book</a></h1>
    <p><a href="/">逗逼+未来の程序员</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/Reading">Reading</a></li>
      
        <li><a href="/about">About</a></li>
      
        <li><a href="/testing">TestArea</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/09/13/进度条控件/">
  <time datetime="2015-09-13T15:43:02.000Z">
    2015-09-13
  </time>
</a>
    
    
  
    <h1 class="title">进度条控件</h1>
  

  </header>
  
  <div class="entry">
    
      <pre><code>var  COREHTML5 = COREHTML5 || {};
COREHTML5.RoundedRectangle = function (strokeStyle,fillStyle,horizontalSizePercent,verticalSizePercent){
    this.strokeStyle = strokeStyle ?strokeStyle :&apos;gray&apos;;
    this.fillStyle = fillStyle? fillStyle :&apos;skyblue&apos;;
    horizontalSizePercent = horizontalSizePercent ||100;
    verticalSizePercent = verticalSizePercent ||100;
    this.SHADOW_COLOR = &apos;rgba(100,100,100,0.8)&apos;;
    this.SHADOW_OFFSET_X = 3;
    this.SHADOW_OFFSET_Y = 3;
    this.SHADOW_BLUR = 3;
    this.setSizePercents(horizontalSizePercent,verticalSizePercent);
    this.createCanvas();
    this.createDOMElement();
    return this;

}
COREHTML5.RoundedRectangle.prototype = {
    createCanvas: function (){
        var canvas = document.createElement(&apos;canvas&apos;);
        this.context = canvas.getContext(&apos;2d&apos;);
        return canvas;
    },
    createDOMElement: function (){
        this.domElement = document.createElement(&apos;div&apos;);
        this.domElement.appendChild(this.context.canvas);
    },
    appendTo : function (element){
        element.appendChild(this.domElement);
        this.domElement.style.width = element.offsetWidth +&apos;px&apos;;
        this.dimElement.style.height = element.offsetHeight + &apos;px&apos;;
        this.resize(element.offsetWidth,element.offsetHeight);
    },
    resize :function (width,height) {
        this.HORIZONTAL_MARGIN = (width - width *this.horizontalSizePercent)/2;
        this.VERTICAL_MARGIN = (height - height *this.verticalSizePercent)/2;
        this.cornerRadius = (this.context.canvas.height/2 - 2*this.VERTICAL_MARGIN)/2;
        this.top = this.VERTICAL_MARGIN;
        this.left = this.HORIZONTAL_MARGIN;
        this.right = this.left + width- 2*this.HORIZONTAL_MARGIN;
        this.bottom = this.top + height -2*this.VERTICAL_MARGIN;
        this.context.canvas.width = width;
        this.context.canvas.height = height;
    },
    setSizePercents : function (h,v) {
        this.horizontalSizePercent = h &gt;1? h/100:h;
        this.verticalSizePercent = v&gt;1 ?v/100:v;

    },
    fill :function (){
        var radius = (this.bottom - this.top)/2;
        this.context.save();
        this.context.shadowColor = this.SHADOW_COLOR;
        this.context.shadowOffsetX = this.SHADOW_OFFSET_X;
        this.context.shadowOffsetY = this.SHADOW_OFFSET_Y;
        this.context.shadowBlur = 6;
        this.context.beginPath();
        this.context.moveTo(this.left + radius ,this.top);
        this.context.arcTo(this.right,this.top,this.right,this.bottom,radius);
        this.context.arcTo(this.right,this.bottom,this.left,this.bottom,radius);
        this.context.arcTo(this.left,this.bottom,this.left,this.top,radius);
        this.context.arcTo(this.left,this.top,this.right,this.top,radius);
        this.context.closePath();
        this.context.fillStyle = this.fillStyle;
        this.context.fill();
        this.context.shadowColor = undefined;

    },
    overlayGradient: function (){
        console.log(this.left,this.right,this.top,this.bottom);
        var gradient = this.context.createLinearGradient(this.left,this.top,this.left,this.bottom);
        gradient.addColorStop(0,&apos;rgba(255,255,255,0.4)&apos;);
        gradient.addColorStop(0.2,&apos;rgba(255,255,255,0.6)&apos;);
        gradient.addColorStop(0.25,&apos;rgba(255,255,255,0.7)&apos;);
        gradient.addColorStop(0.3,&apos;rgba(255,255,255,0.9)&apos;);
        gradient.addColorStop(0.4,&apos;rgba(255,255,255,0.7)&apos;);
        gradient.addColorStop(0.45,&apos;rgba(255,255,255,0.6)&apos;);
        gradient.addColorStop(0.6,&apos;rgba(255,255,255,0.4)&apos;);
        gradient.addColorStop(1,&apos;rgba(255,255,255,0.1)&apos;);
        this.context.fillStyle = gradient;
        this.context.fill();
        this.context.lineWidth = 0.4;
        this.context.strokeStyle = this.strokeStyle;
        this.context.stroke();
        this.context.restore();
    },
    draw: function (context) {
        var originalContext;
        if (context) {
            originalContext = this.context;
            this.context =context;

        } 
        this.fill();
        this.overlayGradient();
        if (context) {
            this.context = originalContext;
        }
    },
    erase: function (){
        this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);
    }

};
COREHTML5.Progressbar = function (strokeStyle,fillstyle,horizontalSizePercent,verticalSizePercent) {
    this.trough = new COREHTML5.RoundedRectangle(strokeStyle,fillstyle,horizontalSizePercent,verticalSizePercent);
    this.SHADOW_COLOR = &apos;rgba(255,255,255,0.5)&apos;;
    this.SHADOW_BLUR = 3;
    this.SHADOW_OFFSET_X = 2;
    this.SHADOW_OFFSET_Y = 2;
    this.percentComplete = 0;
    this.createCanvas();
    this.createDOMElement();

    return this;
}
COREHTML5.Progressbar.prototype = {
    createDOMElement:function() {
        this.domElement = document.createElement(&apos;div&apos;);
        this.domElement.appendChild(this.context.canvas)
    },
    createCanvas :function (){
        this.context = document.createElement(&apos;canvas&apos;).getContext(&apos;2d&apos;);
        this.offscreen = document.createElement(&apos;canvas&apos;).getContext(&apos;2d&apos;);
    },
    appendTo: function (element){
        element.appendChild(this.domElement);
        this.domElement.style.width = element.offsetWidth + &apos;px&apos; ;
        this.domElement.style.height = element.offsetHeight + &apos;px&apos;;
        this.resize();
        this.trough.resize(element.offsetWidth,element.offsetHeight);
        this.trough.draw(this.offscreen);
    },
    setCanvasSize: function (){
        var domElementParent = this.domElement.parentNode;
        this.context.canvas.width = domElementParent.offsetWidth;
        this.context.canvas.height = domElementParent.offsetHeight;
    },
    resize: function(){
        var domElementParent = this.domElement.parentNode,
        w = domElementParent.offsetWidth,
        h = domElementParent.offsetHeight;
        this.setCanvasSize();
        this.context.canvas.width = w;
        this.context.canvas.height = h;
        this.offscreen.canvas.width = w;
        this.offscreen.canvas.height = h;


    },
    draw:function (percentComplete) {
        if(percentComplete &gt; 0){
            this.context.drawImage(this.offscreen.canvas,0,0,
                this.offscreen.canvas.width*(percentComplete/100),this.offscreen.canvas.height,0,0,this.offscreen.canvas.width*(percentComplete/100),this.offscreen.canvas.height);

        }
    },
    erase:function (){
        this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);
    },
};
var startButton = document.getElementById(&apos;startButton&apos;),
    loadingSpan = document.getElementById(&apos;loadingSpan&apos;),
    progressbar = new COREHTML5.Progressbar(&apos;rgba(0,0,0,0.2)&apos;,&apos;teal&apos;,90,70),
    percentComplete = 0;
    startButton.onclick = function (e) {
        loadingSpan.style.display = &apos;inline&apos;;
        startButton.style.display = &apos;none&apos;;
        percentComplete += 1.0;
        if( percentComplete &gt;100) {
            percentComplete = 0;
            loadingSpan.style.display = &apos;none&apos;;
            startButton.style.display = &apos;inline&apos;;
        }
        else{
            progressbar.erase();
            progressbar.draw(percentComplete);
            requestAnimationFrame(startButton.onclick);
        }
    };
    progressbar.appendTo(document.getElementById(&apos;progressbarDiv&apos;));
</code></pre>
    
  </div>
  <footer>
    
      
      
  <div class="tags">
    <a class="tags-link" href="/tags/HTML5-canvas/">HTML5|canvas</a>
  </div>

    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2017 <a href="/">kyjo2014</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>