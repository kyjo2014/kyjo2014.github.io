<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>碰撞检测案列 | LTH&#39;s note book</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="kyjo2014">
  
  
    <meta name="description" content="‘var Vector = function (x,y){    this.x = x;    this.y = y;};Vector.prototype = {getMagnitude:function (){    return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));},add: function (vector){    var v">
  
  <meta name="description" content="‘var Vector = function (x,y){    this.x = x;    this.y = y;};Vector.prototype = {getMagnitude:function (){    return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));},add: function (vector){    var v">
<meta property="og:type" content="article">
<meta property="og:title" content="碰撞检测案列">
<meta property="og:url" content="http://yoursite.com/2015/08/28/碰撞检测案列/index.html">
<meta property="og:site_name" content="LTH's note book">
<meta property="og:description" content="‘var Vector = function (x,y){    this.x = x;    this.y = y;};Vector.prototype = {getMagnitude:function (){    return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));},add: function (vector){    var v">
<meta property="og:updated_time" content="2015-08-28T14:29:17.862Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="碰撞检测案列">
<meta name="twitter:description" content="‘var Vector = function (x,y){    this.x = x;    this.y = y;};Vector.prototype = {getMagnitude:function (){    return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));},add: function (vector){    var v">
  
    <link rel="alternate" href="/atom.xml" title="LTH&#39;s note book" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">LTH&#39;s note book</a></h1>
    <p><a href="/">逗逼+未来の程序员</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/Reading">Reading</a></li>
      
        <li><a href="/about">About</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/08/28/碰撞检测案列/">
  <time datetime="2015-08-28T14:26:46.000Z">
    2015-08-28
  </time>
</a>
    
    
  
    <h1 class="title">碰撞检测案列</h1>
  

  </header>
  
  <div class="entry">
    
      <p>‘var Vector = function (x,y){<br>    this.x = x;<br>    this.y = y;<br>};<br>Vector.prototype = {<br>getMagnitude:function (){<br>    return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));<br>},<br>add: function (vector){<br>    var v = new Vector();<br>    v.x = this.x+vector.x;<br>    v.y = this.y+vector.y;<br>    return v;<br>},<br>substract: function (vector){<br>    var v= new Vector();<br>    v.x = this.x - vector.x;<br>    v.y = this.y - vector.y;<br>    return v;</p>
<p>},<br>dotProduct: function (vector){<br>    return this.x<em>vector.x+ this.y</em>vector.y;<br>},<br>edge: function(vector) {<br>    return this.substract(vector);<br>},<br>prependicular:function (){<br>    var v = new Vector();<br>    v.x = this.y;<br>    v.y = 0 - this.x;<br>    return v;<br>},<br>normalize: function (){<br>    var v = new Vector(0,0),<br>    m = this.getMagnitude();<br>    if (m!=0){<br>        v.x = this.x/m;<br>        v.y = this.y/m;<br>    }<br>    return v;<br>},<br>normal:function (){<br>    var p = this.prependicular();<br>    return p.normalize();<br>}<br>};</p>
<p>var Projection = function (min,max){<br>    this.min = min;<br>    this.max = max;</p>
<p>};<br>Projection.prototype = {<br>    overlaps:function (projection){<br>        return this.max&gt;projection.min&amp;&amp;projection.max&gt;this.min;<br>    }<br>};</p>
<p>var Shape = function (){<br>    this.x = undefined;<br>    this.y = undefined;<br>    this.strokeStyle = ‘rgba(255,253,208,0.9)’;<br>    this.fillStyle = ‘rgba(147,197,114,0.8)’;<br>};</p>
<p>Shape.prototype = {<br>    collidesWith: function (shape){</p>
<pre><code>    var axes = this.getAxes<span class="params">()</span>.<span class="built_in">concat</span><span class="params">(shape.getAxes<span class="params">()</span>)</span>;
    return <span class="built_in">!</span>this.separationOnAxes<span class="params">(axes,shape)</span>;
},
separationOnAxes:<span class="function"><span class="keyword">function</span> <span class="params">(axes,shape)</span>{</span>
    <span class="keyword">for</span> <span class="params">(var i=<span class="number">0</span>;i&lt;axes.length;++i)</span> {
        axis = axes[i];
        projection1 = shape.project<span class="params">(axis)</span>;
        projection2 = this.project<span class="params">(axis)</span>;
        <span class="keyword">if</span> <span class="params">(! projection1.overlaps<span class="params">(projection2)</span>)</span> {
            return <span class="literal">true</span>;
        }
    }
    return <span class="literal">false</span>;
},
project:<span class="function"><span class="keyword">function</span> <span class="params">(axis)</span> {</span>
    throw 'project<span class="params">(axis)</span> not implemented';
},
getAxes:<span class="function"><span class="keyword">function</span> <span class="params">()</span>{</span>
    throw 'getAxes<span class="params">()</span> not implemented';
},
move :<span class="function"><span class="keyword">function</span> <span class="params">(dx,dy)</span>{</span>
    throw 'move<span class="params">(dx,dy)</span>not implemented';
},
createPath: <span class="function"><span class="keyword">function</span> <span class="params">(context)</span> {</span>
    throw 'createPath<span class="params">(context)</span> not implemented';
},
fill : <span class="function"><span class="keyword">function</span> <span class="params">(context)</span>{</span>
    context.save<span class="params">()</span>;
    context.fillStyle = this.fillStyle;
    this.createPath<span class="params">(context)</span>;
    context.fill<span class="params">()</span>;
    context.restore<span class="params">()</span>;
},
stroke: <span class="function"><span class="keyword">function</span> <span class="params">(context)</span>{</span>
    context.save<span class="params">()</span>;
    context.strokeStyle = this.strokeStyle;
    this.createPath<span class="params">(context)</span>;
    context.stroke<span class="params">()</span>;
    context.restore<span class="params">()</span>;
},
isPointInPath: <span class="function"><span class="keyword">function</span> <span class="params">(context,x,y)</span> {</span>
    this.createPath<span class="params">(context)</span>;
    return context.isPointInPath<span class="params">(x,y)</span>;
},
</code></pre><p>};</p>
<p>function detectCollisions(){<br>    var textY = 30,<br>    numShapes = shapes.length,<br>    shape,i;<br>    if (shapeBeingDragged) {<br>        for (i =0;i&lt;numShapes;++i) {<br>            shape = shapes[i];<br>            if (shape!==shapeBeingDragged) {<br>                if (shapeBeingDragged.collidesWith(shape)) {<br>                    context.fillStyle = shape.fillStyle;<br>                    context.fillText(‘collision’,20,textY);<br>                    textY +=40;<br>                }<br>            }<br>        }<br>    }<br>}<br>var Point = function (x,y) {<br>    this.x = x;<br>    this.y = y;</p>
<p>};<br>var Polygon = function (){<br>    this.points = [];<br>    this.strokeStyle = ‘blue’;<br>    this.fillStyle = ‘white’;<br>};<br>Polygon.prototype = new Shape();<br>Polygon.prototype.getAxes = function (){<br>    var v1 = new Vector(),<br>        v2 = new Vector(),<br>        axes = [];<br>    for (var i=0; i&lt;this.points.length-1;i++) {<br>        v1.x = this.points[i].x;<br>        v1.y = this.points[i].y;<br>        v2.x = this.points[i+1].x;<br>        v2.y = this.points[i+1].y;<br>        axes.push(v1.edge(v2).normal());<br>    }<br>    v1.x = this.points[this.points.length-1].x;<br>    v1.y = this.points[this.points.length-1].y;</p>
<pre><code>v2.x = <span class="keyword">this</span>.points[<span class="number">0</span>].x;
v2.y = <span class="keyword">this</span>.points[<span class="number">0</span>].y;
axes.push(v1.edge(v2).normal());
<span class="keyword">return</span> axes;
</code></pre><p>};<br>Polygon.prototype.project = function (axis){<br>    var scalars = [],<br>    v = new Vector();<br>    this.points.forEach(function (point){<br>        v.x = point.x;<br>        v.y = point.y;<br>        scalars.push(v.dotProduct(axis));<br>    });<br>    return new Projection(Math.min.apply(Math,scalars),Math.max.apply(Math,scalars));<br>};<br>Polygon.prototype.addPoint = function (x,y){<br>    this.points.push(new Point(x,y));<br>};<br>Polygon.prototype.createPath = function (context) {<br>if (this.points.length == 0) {<br>    return ;</p>
<p>}<br>context.beginPath();<br>context.moveTo(this.points[0].x,this.points[0].y);<br>for (var i=0;i&lt;this.points.length;++i) {<br>    context.lineTo(this.points[i].x,this.points[i].y);<br>}<br>context.closePath();<br>};<br>Polygon.prototype.move = function (dx,dy){<br>    for (var i=0 ,point;i&lt;this.points.length;++i) {<br>        point = this.points[i];<br>        point.x += dx;<br>        point.y += dy;<br>    }<br>};</p>
<p>var canvas = document.getElementById(‘canvas’);<br>    context = canvas.getContext(‘2d’);<br>    shapes = [];<br>    polygonPoints = [<br>    [new Point(250,150),new Point(250,250),new Point(350,250)],<br>    [new Point(100,100),new Point(100,150),new Point(150,150),new Point(150,100)],<br>    [new Point(400,100),new Point(380,150),new Point(500,150),new Point(520,100)],[new Point(300,150),new Point(280,150),new Point(400,150),new Point(420,100)]<br>    ],<br>    polygonStrokeStyles = [‘blue’,’yellow’,’red’],<br>    polygonFillStyle = [‘rgba(255,255,0,0.7)’,’rgba(100,140230,0.6)’,’rgba(255,255,255,0.8)’],<br>    mousedown = { x:0,y:0},<br>    lastdrag = {x:0,y:0},<br>    shapeBeingDragged = undefined;<br>    function windowToCanvas(x,y){<br>        var bbox = canvas.getBoundingClientRect();<br>        return {<br>            x: x-bbox.left<em>(canvas.width/bbox.width),<br>            y: y-bbox.top </em>(canvas.height/bbox.height)<br>        };<br>    }<br>    function drawShapes (){<br>        shapes.forEach(function(shape){<br>            shape.stroke(context);shape.fill(context);<br>        });<br>    }<br>    function detectCollisions(){<br>    var textY = 30,<br>    numShapes = shapes.length,<br>    shape,i;<br>    if (shapeBeingDragged) {<br>        for (i =0;i&lt;numShapes;++i) {<br>            shape = shapes[i];<br>            if (shape!==shapeBeingDragged) {<br>                if (shapeBeingDragged.collidesWith(shape)) {<br>                    context.fillStyle = shape.fillStyle;<br>                    context.fillText(‘collision’,20,textY);<br>                    textY +=40;<br>                }<br>            }<br>        }<br>    }<br>}<br>    canvas.onmousedown = function (e){<br>        var location = windowToCanvas(e.clientX,e.clientY);<br>        shapes.forEach( function(shape){<br>            if(shape.isPointInPath(context,location.x,location.y)){<br>                shapeBeingDragged = shape;<br>                mousedown.x = location.x;<br>                mousedown.y = location.y;<br>                lastdrag.x = location.x;<br>                lastdrag.y = location.y;</p>
<pre><code>        }
    })<span class="comment">;</span>
}<span class="comment">;</span>
canvas.onmousemove = function (e) {
    var location,
    dragVector<span class="comment">;</span>
    if(shapeBeingDragged !== undefined) {
        location = windowToCanvas(e.clientX,e.clientY)<span class="comment">;</span>
        dragVector = {
            x:location.x - lastdrag.x,
            y: location.y - lastdrag.y

        }<span class="comment">;</span>
        shapeBeingDragged.move(dragVector.x,dragVector.y)<span class="comment">;</span>
        lastdrag.x = location.x<span class="comment">;</span>
        lastdrag.y = location.y<span class="comment">;</span>
        context.clearRect(0,0,canvas.width,canvas.height)<span class="comment">;</span>
        drawShapes()<span class="comment">;</span>
        detectCollisions()<span class="comment">;</span>
    }
}<span class="comment">;</span>
canvas.onmouseup = function (e) {
    shapeBeingDragged = undefined<span class="comment">;</span>
}
for (var i=0<span class="comment">;i&lt;polygonPoints.length;++i) {</span>
    var polygon = new Polygon()<span class="comment">;</span>
    points = polygonPoints[i]<span class="comment">;</span>
    polygon.strokeStyle = polygonStrokeStyles[i]<span class="comment">;</span>
    points.forEach(function (point){
        polygon.addPoint(point.x,point.y)<span class="comment">;</span>
    })<span class="comment">;</span>
    shapes.push(polygon)<span class="comment">;</span>


}
context.shadowColor = 'rgba(<span class="number">100,140,255,0</span>.5)'<span class="comment">;</span>
context.shadowBlur = 4<span class="comment">;</span>
context.shadowOffsetX = 2<span class="comment">;</span>
context.shadowOffsetY = 2<span class="comment">;</span>
context.font = '38px Arial'<span class="comment">;</span>
drawShapes()<span class="comment">;</span>
context.save()<span class="comment">;</span>
context.fillStyle = 'cornflowerblue'<span class="comment">;</span>
context.font = '24px Arial'<span class="comment">;</span>
context.fillText('Drag shapes over each other',10,25)<span class="comment">;</span>
context.restore()<span class="comment">;</span>
</code></pre><p>’</p>

    
  </div>
  <footer>
    
      
      
  <div class="tags">
    <a class="tags-link" href="/tags/HTML5-canvas/">HTML5|canvas</a>
  </div>

    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2015 <a href="/">kyjo2014</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>